# StoryFi Subnet 92 - æœ€æ–°è¿›å±•

> æ›´æ–°æ—¶é—´: 2025-12-12 16:00
> ä½œè€…: Claude Code Agent

---

## ä¸€ã€å½“å‰çŠ¶æ€

### å·²å®Œæˆ
- âœ… Subnet 92 å·²åœ¨ Bittensor Mainnet (Finney) æ³¨å†Œ
- âœ… Validator (UID 11) å’Œ Miner (UID 12) å·²æ³¨å†Œå¹¶è¿è¡Œ
- âœ… Miner-Validator Loop å·²è·‘é€šï¼ŒæŒç»­è¿è¡Œ 1+ å°æ—¶æ— é”™è¯¯
- âœ… ä»£ç å·²æ¨é€ GitHub: https://github.com/vya42/storyfi-subnet

### è¿è¡Œç»Ÿè®¡
- Miner: 87+ è¯·æ±‚å¤„ç†ï¼Œ0 é”™è¯¯ï¼Œå¹³å‡å“åº” 30.7 ç§’
- Validator: æŒç»­è¯„åˆ† 12.50 points
- Emissions: å°šæœªæ¿€æ´»ï¼ˆå­ç½‘åœ¨å…ç–«æœŸï¼‰

---

## äºŒã€å…³é”®é…ç½®ä¿¡æ¯

### é’±åŒ…é…ç½®
```
Owner é’±åŒ…: sn92_owner
â”œâ”€â”€ Validator Hotkey: validator_hotkey (UID 11)
â”‚   â””â”€â”€ SS58: 5FsF8VeRfZGRYAf2QiiYC1EJmXPjbo3Ww7xL6kmDggPzuAuc
â””â”€â”€ Miner Hotkey: miner_hotkey (UID 12)
    â””â”€â”€ SS58: 5DSVBNPW45VzzTgug3At6DyH5VGUPr78SC6gtqw4QNzEmQbb
```

### Miner å¯åŠ¨å‘½ä»¤ (å½“å‰ä½¿ç”¨ ngrok)
```bash
python neurons/miner.py \
    --netuid 92 \
    --wallet.name sn92_owner \
    --wallet.hotkey miner_hotkey \
    --subtensor.network finney \
    --axon.port 8091 \
    --axon.external_ip 52.77.3.235 \
    --axon.external_port 12872 \
    --logging.info
```

### Validator å¯åŠ¨å‘½ä»¤
```bash
python neurons/validator.py \
    --netuid 92 \
    --wallet.name sn92_owner \
    --wallet.hotkey validator_hotkey \
    --subtensor.network finney \
    --logging.info
```

### ngrok éš§é“ (å½“å‰)
```
ngrok tcp 8091
# éš§é“åœ°å€: tcp://0.tcp.ap.ngrok.io:12872
# è§£æ IP: 52.77.3.235
```

---

## ä¸‰ã€å…³é”® Bug ä¿®å¤

### 1. Dendrite è¿”å› dict è€Œé Synapse å¯¹è±¡
**é—®é¢˜**: Validator æ”¶åˆ° `dict` ç±»å‹å“åº”ï¼Œå¯¼è‡´ `hasattr(response, 'output_data')` å¤±è´¥

**è§£å†³æ–¹æ¡ˆ** (neurons/validator.py:747-774):
```python
if isinstance(response, dict):
    # å¦‚æœ response æ˜¯ dictï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ output_data å­—æ®µ
    if 'output_data' in response:
        output_data_val = response.get('output_data')
    else:
        # dendrite å¯èƒ½ç›´æ¥è¿”å› output_data å†…å®¹
        output_data_val = response

    # è½¬æ¢ä¸º Synapse å¯¹è±¡ç»Ÿä¸€å¤„ç†
    response = StoryGenerationSynapse(
        task_type=response.get('task_type', synapse.task_type),
        output_data=output_data_val,
        ...
    )
```

### 2. History ç±»å‹é”™è¯¯
**é—®é¢˜**: `scoring/content.py` ä¸­ `calculate_originality()` æœŸæœ› stringï¼Œå®é™…æ”¶åˆ° dict

**è§£å†³æ–¹æ¡ˆ** (scoring/content.py:243-261):
```python
for historical_response in history[-100:]:
    if isinstance(historical_response, dict):
        hist_str = json.dumps(historical_response, ensure_ascii=False, sort_keys=True)
    else:
        hist_str = str(historical_response)
    historical_hash = hashlib.sha256(hist_str.encode()).hexdigest()
```

### 3. external_port å‚æ•°æœªç”Ÿæ•ˆ
**é—®é¢˜**: `--axon.external_port` å‚æ•°æœªåœ¨ argparse ä¸­å®šä¹‰

**è§£å†³æ–¹æ¡ˆ** (neurons/miner.py:332):
```python
parser.add_argument("--axon.external_port", type=int, default=None,
                    help="External port (for NAT/tunnel scenarios)")
```

å¹¶åœ¨ `setup_axon()` ä¸­æ·»åŠ è¦†ç›–é€»è¾‘ (neurons/miner.py:101-112)ã€‚

---

## å››ã€æ¶æ„è¯´æ˜

### Generator ç³»ç»Ÿ
```
generators/
â”œâ”€â”€ base.py              # æŠ½è±¡åŸºç±»
â”œâ”€â”€ api_generator.py     # API æ¨¡å¼ (å½“å‰ä½¿ç”¨)
â”œâ”€â”€ local_generator.py   # æœ¬åœ° GPU æ¨¡å¼
â”œâ”€â”€ mock_generator.py    # Mock æ¨¡å¼ (å¯ç”¨äºæµ‹è¯•/çœé’±)
â””â”€â”€ loader.py            # æ™ºèƒ½åŠ è½½å™¨
```

å½“å‰ä½¿ç”¨ **API æ¨¡å¼**ï¼Œé…ç½®æ–‡ä»¶: `config/generator_config.yaml`
```yaml
generator:
  mode: "api"
  api:
    provider: "openai"
    api_key_env: "ZHIPU_API_KEY"
    model: "glm-4-flash"
    endpoint: "https://open.bigmodel.cn/api/paas/v4"
```

### è¯„åˆ†ç³»ç»Ÿ
- æŠ€æœ¯åˆ† (30%): JSON æ ¼å¼ã€å“åº”æ—¶é—´ã€å­—æ®µå®Œæ•´æ€§
- ç»“æ„åˆ† (40%): å†…å®¹ç»“æ„ã€å­—æ®µè´¨é‡
- å†…å®¹åˆ† (30%): åˆ›æ„æ€§ã€è¿è´¯æ€§ã€åŸåˆ›æ€§

### Mock Generator (å¯é€‰)
å¦‚æœæƒ³çœ API è´¹ç”¨ï¼Œå¯ä»¥ç”¨ mock æ¨¡å¼è¿”å›é¢„è®¾å†…å®¹ã€‚Validator åªçœ‹è¾“å‡ºè´¨é‡ï¼Œä¸çŸ¥é“å†…å®¹æ¥æºã€‚

ä¿®æ”¹ `config/generator_config.yaml`:
```yaml
generator:
  mode: "mock"
```

---

## äº”ã€å¾…åŠäº‹é¡¹

### ç´§æ€¥
- [ ] æ¿€æ´» Subnet 92 Emissions (éœ€è¦ç­‰å…ç–«æœŸç»“æŸæˆ–æ‰‹åŠ¨è§¦å‘)

### é‡è¦
- [ ] æœ‹å‹éƒ¨ç½² Miner å‰éœ€è¦ï¼š
  - æœåŠ¡å™¨æœ‰å…¬ç½‘ IP
  - å¼€æ”¾ç«¯å£ 8091
  - é…ç½® LLM API Key
  - çº¦ 0.1 TAO æ³¨å†Œè´¹

### ä¼˜åŒ–
- [ ] æå‡è¯„åˆ† (å½“å‰ 12.50ï¼Œå¯é€šè¿‡æä¾› model_info é¿å… 0.5x penalty)
- [ ] å¢åŠ æ›´å¤š mock æ•…äº‹æ¨¡æ¿
- [ ] å®Œå–„ README éƒ¨ç½²æ–‡æ¡£

---

## å…­ã€é“¾ä¸Šä¿¡æ¯

### æŸ¥çœ‹ Subnet 92
```bash
# å­ç½‘åˆ—è¡¨
btcli subnet list --subtensor.network finney | grep 92

# Metagraph (æŸ¥çœ‹æ‰€æœ‰ UID)
btcli subnet metagraph --netuid 92 --subtensor.network finney

# åœ¨çº¿æŸ¥çœ‹
https://taostats.io/subnets/netuid-92/metagraph
```

### æ³¨å†Œæ–° Miner
```bash
# 1. åˆ›å»ºé’±åŒ…
btcli wallet create --wallet.name my_miner

# 2. å……å€¼ TAO (çº¦ 0.1 TAO)

# 3. æ³¨å†Œ
btcli subnet register --netuid 92 --wallet.name my_miner --wallet.hotkey default

# 4. å¯åŠ¨
python neurons/miner.py \
    --netuid 92 \
    --wallet.name my_miner \
    --wallet.hotkey default \
    --subtensor.network finney \
    --axon.port 8091 \
    --axon.external_ip YOUR_PUBLIC_IP \
    --logging.info
```

---

## ä¸ƒã€æ—¥å¿—ä½ç½®

```
/Users/xinyueyu/Desktop/bittensor/storyfi-subnet/miner.log
/Users/xinyueyu/Desktop/bittensor/storyfi-subnet/validator.log
```

å…³é”®æ—¥å¿—æ¨¡å¼:
- Miner æˆåŠŸ: `âœ… Generated {task_type} in {time}s`
- Validator è¯„åˆ†: `ğŸ“Š Miner {uid} ({ip}): {score} points`
- é”™è¯¯: `ERROR`

---

## å…«ã€Git æäº¤å†å²

```
63b9319 docs: Update README for Subnet 92 production deployment
8d6940c fix: Handle dict response from dendrite and fix history type issue
1bdf012 feat: Add external_port support for NAT/tunnel scenarios
0199d5a chore: Update default netuid from 108 to 92
```

---

## ä¹ã€é‡è¦æé†’

1. **ngrok ä¼šå˜**: æ¯æ¬¡é‡å¯ ngrokï¼ŒIP/ç«¯å£ä¼šå˜ï¼Œéœ€è¦é‡æ–°æ³¨å†Œ axon
2. **å…ç–«æœŸ**: Subnet 92 åœ¨å…ç–«æœŸå†…ä¸ä¼šè¢«æ·˜æ±°ï¼Œä½†ä¹Ÿæ²¡æœ‰ emissions
3. **API Key**: å½“å‰ä½¿ç”¨æ™ºè°± AI (ZHIPU_API_KEY)ï¼Œè´¹ç”¨è¾ƒä½
4. **Mock å¯ç”¨**: å¦‚æœåªæ˜¯æµ‹è¯•ï¼Œå¯ä»¥ç”¨ mock æ¨¡å¼çœé’±

---

*æ–‡æ¡£ç»“æŸ*
